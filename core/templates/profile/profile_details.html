{% extends 'base.html' %}

{% block title %}
    Profilni tahrirlash
{% endblock %}

{% block content %}
<div class="flex justify-center py-10">
    <div class="w-full max-w-xl bg-gray-800 rounded-xl shadow-xl p-8">
        <h2 class="text-3xl font-semibold mb-6 text-blue-400 text-center">Profile Details</h2>

        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}

            <!-- Profile Avatar with Upload & Delete Buttons -->
            <div class="flex flex-col items-center mb-6">
                <div class="relative w-32 h-32 mb-2">
                    {% if profile.profile_image %}
                        <img id="avatarPreview" src="{{ profile.profile_image.url }}" alt="Profile Avatar"
                             class="w-32 h-32 rounded-full border-2 border-blue-400 shadow-md object-cover">
                    {% else %}
                        <div id="avatarPreview" class="w-32 h-32 rounded-full bg-gray-700 flex items-center justify-center text-4xl border-2 border-blue-400 shadow-md">
                            ðŸ‘¤
                        </div>
                    {% endif %}
                </div>

                <div class="flex space-x-4">
                    <!-- Upload Button -->
                    <label for="profile_image"
                           class="flex flex-col items-center bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg cursor-pointer shadow-md transition">
                        <i class="fas fa-upload text-lg mb-1"></i>
                        <span class="text-sm font-medium">Upload Image</span>
                    </label>
                    <input type="file" name="profile_image" id="profile_image" accept="image/*" class="hidden"/>

                    <!-- Delete Button -->
                    <button type="button" id="deleteAvatar"
                            class="flex flex-col items-center bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg shadow-md transition">
                        <i class="fas fa-trash text-lg mb-1"></i>
                        <span class="text-sm font-medium">Delete Image</span>
                    </button>
                </div>
            </div>

            <!-- Bio -->
            <div>
                <label for="bio" class="block mb-2 font-medium text-gray-300">Your Bio</label>
                <textarea id="bio" name="bio" rows="4"
                          class="w-full bg-gray-700 text-gray-100 p-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">{{ form.bio.value }}</textarea>
            </div>

            <!-- Trader Type -->
            <div>
                <label for="trader_type" class="block mb-2 font-medium text-gray-300">Trader Type</label>
                <select id="trader_type" name="trader_type"
                        class="w-full bg-gray-700 text-gray-100 p-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="crypto" {% if form.trader_type.value == 'crypto' %}selected{% endif %}>Crypto</option>
                    <option value="forex" {% if form.trader_type.value == 'forex' %}selected{% endif %}>Forex</option>
                    <option value="other" {% if form.trader_type.value == 'other' %}selected{% endif %}>Other</option>
                </select>
            </div>

            <!-- Forex Account Type -->
            <div>
                <label for="forex_account_type" class="block mb-2 font-medium text-gray-300">Forex Account Type</label>
                <select id="forex_account_type" name="forex_account_type"
                        class="w-full bg-gray-700 text-gray-100 p-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="personal" {% if form.forex_account_type.value == 'personal' %}selected{% endif %}>Personal Account</option>
                    <option value="funded" {% if form.forex_account_type.value == 'funded' %}selected{% endif %}>Funded Account</option>
                </select>
            </div>

            <!-- Submit Button -->
            <div class="text-center">
                <button type="submit"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-colors duration-300">
                    Update Profile
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    const avatarInput = document.getElementById('profile_image');
    const avatarPreview = document.getElementById('avatarPreview');
    const deleteBtn = document.getElementById('deleteAvatar');

    // Preview uploaded avatar
    avatarInput.addEventListener('change', function(event) {
        const reader = new FileReader();
        reader.onload = function() {
            if(avatarPreview.tagName === 'IMG') {
                avatarPreview.src = reader.result;
            } else {
                avatarPreview.style.backgroundImage = `url(${reader.result})`;
                avatarPreview.innerHTML = '';
                avatarPreview.style.backgroundSize = 'cover';
                avatarPreview.style.backgroundPosition = 'center';
            }
        }
        reader.readAsDataURL(event.target.files[0]);
    });

    // Delete avatar
    deleteBtn.addEventListener('click', function() {
        if(avatarPreview.tagName === 'IMG') {
            avatarPreview.src = '';
        } else {
            avatarPreview.style.backgroundImage = '';
            avatarPreview.innerHTML = 'ðŸ‘¤';
        }
        avatarInput.value = '';
    });
</script>
{% endblock %}
